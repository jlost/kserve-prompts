# JIRA Research

Deep investigation of a JIRA issue to find existing work and related context across all KServe forks.

## Instructions

Given a JIRA key (e.g., RHOAIENG-1234), perform a comprehensive investigation:

### Step 1: Fetch JIRA Details

Use JIRA MCP to get full context:
- Fetch the issue with `fields: *all` and `expand: changelog`
- Extract: summary, description, issue type, fix versions, priority, assignee
- Check the changelog for **RemoteIssueLink** entries (GitHub PRs/issues)
- Check for linked JIRA issues (parent epics, sub-tasks, related issues)
- **Extract key terms** for deep search:
  - Error messages, stack traces, log snippets
  - Function/class names, file paths mentioned
  - Component names (e.g., "transformer", "predictor", "storage initializer")
  - Behavioral keywords (e.g., "nil pointer", "timeout", "race condition")

### Step 2: Deep Search for Existing Work

**Search GitHub** across all three forks using GitHub MCP:

**Search by JIRA key:**
- Search PRs: `RHOAIENG-1234` in title/body
- Search issues: `RHOAIENG-1234` in title/body
- Search commits mentioning the JIRA key

**Search by keywords/phrases** extracted from JIRA:
- PRs/issues containing key error messages or symptoms
- PRs touching files/functions mentioned in the JIRA
- Recent changes to affected components (use code search)
- Similar bug reports in GitHub issues

**Forks to search:**
- `kserve/kserve` (upstream)
- `opendatahub-io/kserve` (ODH/midstream)
- `red-hat-data-services/kserve` (downstream)

**Search Slack** (if appropriate) using Slack MCP:
- Search for messages mentioning the JIRA key
- Search for key error messages or symptoms
- Look for discussions about the affected component
- Note any context, workarounds, or insights shared by team members

### Step 3: Compile Findings

Organize results:
- **GitHub:** Group by fork
  - For each PR/issue: number, title, status (open/merged/closed), author, date
  - Assign relevance: High (exact match), Medium (related), Low (possibly related)
  - Note cherry-pick relationships between PRs
  - Identify if fix exists but needs cherry-picking
- **Slack:** Summarize relevant discussions
  - Note any workarounds or context shared
  - Link to threads if they contain useful information

### Step 4: Check for Existing Investigation Comment

Before creating a new comment, search the JIRA comments for an existing "Investigation Notes" comment (look for `h3. Investigation Notes` heading).

- If found: **update** the existing comment
- If not found: **create** a new comment

### Step 5: Create/Update JIRA Comment

**Present the findings to the user first** and ask for confirmation before posting.

Use this JIRA wiki markup template:

```
h3. Investigation Notes (Bot-Generated)

{panel:bgColor=#f0f0f0}
This comment was automatically generated by an AI assistant (Cursor Agent) to document investigation findings. It may be updated as new information is discovered.
{panel}

*Requested by:* {{user_name}}
*Date:* {{current_date}}
*Search terms:* {{extracted_keywords}}

h4. Related PRs Found

|| Fork || PR || Title || Status || Relevance ||
| kserve/kserve | [#1234|https://github.com/kserve/kserve/pull/1234] | Fix nil pointer in transformer | Merged | High - same error |
| opendatahub-io/kserve | [#567|https://github.com/opendatahub-io/kserve/pull/567] | Cherry-pick #1234 | Open | Cherry-pick |

_(No related PRs found)_ -- use this if empty

h4. Related Issues

* [kserve/kserve#890|https://github.com/kserve/kserve/issues/890] - Similar symptom reported

_(No related issues found)_ -- use this if empty

h4. Slack Discussions

* [Link or summary of relevant Slack threads]

_(No relevant Slack discussions found)_ -- use this if empty or not searched

h4. Analysis

[Summary of findings:]
- Has this been fixed? Where?
- Does it need cherry-picking to other forks?
- Is this a duplicate of another issue?
- What's the root cause (if identifiable)?

h4. Recommendation

[One of the following, based on analysis:]

*Ready to proceed:* Sufficient context to start implementation. Target: [fork/branch]

*Needs cherry-pick:* Fix exists in [fork], needs cherry-pick to [target fork/branch]

*Needs more information:*
- Missing reproduction steps
- Unclear expected vs actual behavior
- Need logs/environment details
- Need clarification from reporter

*Duplicate:* This appears to duplicate [JIRA-KEY or GitHub issue link]
```

**Wait for user confirmation before posting/updating the comment.**

### Step 6: Recommendation

After documenting findings, provide a clear recommendation:

**If ready to proceed:**
> Ready to start work. Run `/jira-work {{jira_key}}` to create a worktree and begin implementation.
> Target: [recommended fork/branch]

**If needs cherry-pick only:**
> Fix exists in [source]. Run `/jira-work {{jira_key}} target:odh/release-v0.15` to cherry-pick.

**If needs more information:**
> Before starting work, gather additional information:
> - [List specific missing pieces]
> - Consider asking the reporter for [specific details]
> - Check [relevant logs/systems] for more context

**If duplicate:**
> This appears to be a duplicate of [reference]. Consider closing as duplicate or linking.

## User Input

JIRA Key: {{jira_key}}

## Example Usage

User: `/jira-research RHOAIENG-1234`

Expected flow:
1. JIRA details fetched and displayed
2. Key terms extracted for search
3. Deep search across all forks (GitHub + Slack)
4. Findings compiled and presented to user
5. **Prompt:** "Post investigation notes to JIRA? [y/n/edit]"
6. If yes, create or update comment
7. Recommendation displayed with next steps

## Notes

- This command focuses on **investigation only** - it does not create worktrees
- Use `/jira-work` after investigation to create the worktree and begin work
- If an investigation comment already exists, it will be **updated** not duplicated
- Always confirm before posting to JIRA

## Related Commands

- `/jira` - Quick context fetch (no deep search, no JIRA comment)
- `/jira-work` - Full workflow: research -> worktree creation

